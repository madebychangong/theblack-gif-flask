<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë”ë¸”ë™ìƒµ - í†µí•© ë„êµ¬</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Noto Sans KR', Arial, sans-serif;
      background-color: #121212;
      color: #fff;
      padding: 20px;
      margin: 0;
    }

    /* ============================================
       íƒ­ ë„¤ë¹„ê²Œì´ì…˜
       ============================================ */
    .tab-navigation {
      max-width: 1400px;
      margin: 0 auto 20px auto;
      display: flex;
      gap: 10px;
      justify-content: center;
      background: #1e1e1e;
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(255,255,255,0.1);
    }

    .tab-btn {
      flex: 1;
      max-width: 400px;
      padding: 15px 30px;
      font-size: 18px;
      font-weight: 700;
      border: 2px solid #333;
      border-radius: 8px;
      background: #2a2a2a;
      color: #aaa;
      cursor: pointer;
      transition: all 0.3s;
    }

    .tab-btn:hover {
      background: #333;
      border-color: #555;
      color: #fff;
    }

    .tab-btn.active {
      background: linear-gradient(135deg, #ffd700, #ffed4e);
      border-color: #ffd700;
      color: #000;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* ============================================
       ê³µí†µ ìŠ¤íƒ€ì¼
       ============================================ */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: #1e1e1e;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(255,255,255,0.1);
    }

    h1 {
      text-align: center;
      margin-bottom: 30px;
      color: #4CAF50;
    }

    h2 {
      color: #ffd700;
      text-align: center;
      margin-bottom: 30px;
    }

    .section {
      background: #2a2a2a;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }

    .section h3 {
      color: #00ffd5;
      margin-top: 0;
    }

    .info-box {
      background: rgba(0, 255, 213, 0.1);
      border: 2px solid #00ffd5;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      font-size: 14px;
    }

    .info-box strong {
      color: #00ffd5;
    }

    textarea {
      width: 100%;
      min-height: 200px;
      padding: 16px;
      font-size: 16px;
      background: #333;
      color: #fff;
      border: 1px solid #555;
      border-radius: 6px;
      resize: vertical;
      line-height: 1.6;
      font-family: 'Noto Sans KR', monospace;
    }

    button {
      margin-top: 15px;
      background-color: #ffd700;
      color: #000;
      border: none;
      padding: 14px 28px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      transition: all 0.3s;
      width: 100%;
    }

    button:hover:not(:disabled) {
      background-color: #ffed4e;
      transform: scale(1.02);
    }

    button:disabled {
      background-color: #666;
      cursor: not-allowed;
      transform: scale(1);
    }

    label {
      display: block;
      margin: 15px 0;
    }

    input[type="text"], input[type="number"] {
      padding: 8px;
      background: #1a1a1a;
      color: #fff;
      border: 2px solid #444;
      border-radius: 5px;
      margin-left: 10px;
    }

    input[type="text"] {
      width: 400px;
    }

    input[type="number"] {
      width: 80px;
    }

    /* ============================================
       íƒ­1: WebP ìƒì„±ê¸° ìŠ¤íƒ€ì¼
       ============================================ */
    #message {
      margin-top: 20px;
      padding: 15px;
      border-radius: 6px;
      text-align: center;
      font-size: 15px;
      display: none;
    }

    #message.show { display: block; }
    #message.info {
      background: #1e3a5f;
      color: #5dade2;
    }
    #message.success {
      background: #1e4d2b;
      color: #52c41a;
    }
    #message.error {
      background: #4d1e1e;
      color: #ff6b6b;
    }

    .progress-bar {
      width: 100%;
      height: 30px;
      background: #333;
      border-radius: 15px;
      overflow: hidden;
      margin: 20px 0;
      display: none;
    }

    .progress-bar.show { display: block; }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #00ffd5, #ffd700);
      width: 0%;
      transition: width 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #000;
      font-weight: bold;
      font-size: 14px;
    }

    .result-box {
      background: #232323;
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #00ffd5;
      margin-top: 30px;
      display: none;
    }

    .result-box.show { display: block; }

    .result-box h4 {
      color: #ffd700;
      margin-top: 0;
    }

    .preview-container {
      background: #1a1a1a;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      text-align: center;
    }

    .preview-container img {
      max-width: 100%;
      border-radius: 8px;
      margin: 10px 0;
    }

    .copy-btn {
      background: #00ffd5;
      color: #000;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      margin: 5px;
      width: auto;
    }

    .copy-btn:hover {
      background: #00e6c3;
    }

    #debugLog {
      background: #0a0a0a;
      color: #0f0;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 20px;
      display: none;
    }

    #debugLog.show { display: block; }

    #hiddenRender {
      position: fixed;
      left: -10000px;
      top: 0;
    }

    /* ì›Œí„°ë§ˆí¬ ì‹œìŠ¤í…œ */
    .watermark-container {
      position: relative;
      width: 720px;
    }

    .corner-badge {
      position: absolute;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 900;
      border-radius: 50%;
      border: 3px solid;
      text-align: center;
      line-height: 1.2;
      box-shadow: 0 0 20px rgba(0,0,0,0.5);
      z-index: 1000;
    }

    .corner-badge.top-left { top: 15px; left: 15px; }
    .corner-badge.top-right { top: 15px; right: 15px; }
    .corner-badge.bottom-left { bottom: 15px; left: 15px; }
    .corner-badge.bottom-right { bottom: 15px; right: 15px; }

    .content-watermark {
      position: absolute;
      font-size: 18px;
      font-weight: 900;
      opacity: 0.2;
      pointer-events: none;
      letter-spacing: 2px;
      text-shadow: 0 0 10px rgba(0,0,0,0.5);
      z-index: 500;
    }

    .wm-diagonal-1 { top: 30%; left: 10%; transform: rotate(-15deg); }
    .wm-diagonal-2 { top: 50%; right: 15%; transform: rotate(15deg); }
    .wm-diagonal-3 { top: 70%; left: 15%; transform: rotate(-12deg); }
    .wm-diagonal-4 { top: 55%; right: 8%; transform: rotate(10deg); }
    .wm-diagonal-5 { top: 65%; left: 10%; transform: rotate(-12deg); }
    .wm-diagonal-6 { top: 75%; right: 12%; transform: rotate(14deg); }
    .wm-diagonal-7 { top: 82%; left: 8%; transform: rotate(-8deg); }
    .wm-diagonal-8 { top: 90%; right: 10%; transform: rotate(12deg); }

    .center-sticker {
      position: absolute;
      bottom: 25px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.85);
      border: 3px solid;
      border-radius: 12px;
      padding: 15px 25px;
      text-align: center;
      box-shadow: 0 0 30px rgba(0,0,0,0.7);
      z-index: 1000;
    }

    .sticker-title {
      font-size: 20px;
      font-weight: 900;
      margin: 0 0 8px 0;
      letter-spacing: 2px;
    }

    .sticker-check {
      font-size: 24px;
      margin: 5px 0;
    }

    .sticker-desc {
      font-size: 13px;
      font-weight: 700;
      margin: 5px 0 0 0;
      line-height: 1.4;
    }

    .frame-1 .corner-badge { background: #ffd700; border-color: #ffd700; color: #000; }
    .frame-1 .content-watermark { color: #ffd700; }
    .frame-1 .center-sticker { border-color: #ffd700; }
    .frame-1 .sticker-title, .frame-1 .sticker-check, .frame-1 .sticker-desc { color: #ffd700; }
    .frame-1 .auth-warning { border-color: #ffd700; color: #ffd700; }

    .frame-2 .corner-badge { background: #00ffd5; border-color: #00ffd5; color: #000; }
    .frame-2 .content-watermark { color: #00ffd5; }
    .frame-2 .center-sticker { border-color: #00ffd5; }
    .frame-2 .sticker-title, .frame-2 .sticker-check, .frame-2 .sticker-desc { color: #00ffd5; }
    .frame-2 .auth-warning { border-color: #00ffd5; color: #00ffd5; }

    .frame-3 .corner-badge { background: #a855f7; border-color: #a855f7; color: #000; }
    .frame-3 .content-watermark { color: #a855f7; }
    .frame-3 .center-sticker { border-color: #a855f7; }
    .frame-3 .sticker-title, .frame-3 .sticker-check, .frame-3 .sticker-desc { color: #a855f7; }
    .frame-3 .auth-warning { border-color: #a855f7; color: #a855f7; }

    .frame-4 .corner-badge { background: #ff6b6b; border-color: #ff6b6b; color: #000; }
    .frame-4 .content-watermark { color: #ff6b6b; }
    .frame-4 .center-sticker { border-color: #ff6b6b; }
    .frame-4 .sticker-title, .frame-4 .sticker-check, .frame-4 .sticker-desc { color: #ff6b6b; }
    .frame-4 .auth-warning { border-color: #ff6b6b; color: #ff6b6b; }

    .price-image {
      width: 720px;
      background: linear-gradient(135deg,
        #1a1a2e 0%,
        #16213e 25%,
        #0f3460 50%,
        #533483 75%,
        #1a1a2e 100%);
      margin: 0;
      padding: 0;
      font-family: 'Noto Sans KR', Arial, sans-serif;
    }

    .auth-warning {
      background: rgba(255, 215, 0, 0.15);
      border: 2px solid;
      border-radius: 12px;
      padding: 12px 15px;
      margin: 15px 40px 20px 40px;
      font-size: 15px;
      font-weight: 700;
      text-align: center;
    }

    .header-static {
      width: 100%;
      background: rgba(0, 0, 0, 0.15);
      backdrop-filter: blur(20px);
      padding: 40px 42px 30px 42px;
      text-align: center;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow:
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        inset 0 -1px 0 rgba(255, 255, 255, 0.05);
    }

    .shop-logo {
      font-size: 46px;
      font-weight: 700;
      color: #ffe85c;
      margin: 0 0 12px 0;
      letter-spacing: 2.5px;
      text-shadow:
        0 0 10px rgba(255, 232, 92, 0.5),
        0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .shop-tagline {
      font-size: 20px;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 400;
      letter-spacing: 0.8px;
      margin: 0 0 20px 0;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    .shop-features {
      list-style: none;
      padding: 0;
      margin: 20px 0 0 0;
      font-size: 18px;
      color: rgba(255, 255, 255, 0.9);
    }

    .shop-features li {
      margin: 8px 0;
      line-height: 1.65;
      letter-spacing: 0.3px;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    .cta-btn {
      margin: 20px auto;
      background: linear-gradient(135deg, #1affeb 0%, #0ee5d0 100%);
      color: #0a0a0a;
      font-weight: 900;
      font-size: 23px;
      padding: 14px 40px;
      border-radius: 22px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      display: inline-block;
      box-shadow:
        0 4px 16px rgba(26, 255, 235, 0.3),
        0 2px 4px rgba(0, 0, 0, 0.1),
        inset 0 1px 0 rgba(255, 255, 255, 0.3);
      letter-spacing: 0.5px;
    }

    .divider {
      border: none;
      border-top: 1px solid rgba(255, 255, 255, 0.15);
      margin: 20px 40px;
    }

    .price-content {
      width: 100%;
      padding: 30px 42px 100px 42px;
    }

    .price-title {
      font-size: 32px;
      color: #3dffb8;
      font-weight: 900;
      margin: 0 0 20px 0;
      text-align: center;
      letter-spacing: 1.2px;
      text-shadow:
        0 0 10px rgba(61, 255, 184, 0.4),
        0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .price-text {
      font-size: 18px;
      color: rgba(255, 255, 255, 0.85);
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
      white-space: pre-wrap;
      line-height: 1.75;
      letter-spacing: 0.6px;
      font-weight: 500;
      backdrop-filter: blur(10px);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .chat-link {
      margin: 10px 0;
      padding: 10px 0;
      font-weight: 800;
    }

    /* ============================================
       íƒ­2: ê°€ê²©í‘œ ë³€í™˜ê¸° ìŠ¤íƒ€ì¼
       ============================================ */
    #tab2 .section h2 {
      color: #66BB6A;
    }

    .preview-box {
      background: white;
      color: black;
      padding: 20px;
      border-radius: 5px;
      min-height: 200px;
      max-height: 600px;
      overflow-y: auto;
      margin-top: 15px;
    }

    .warning {
      background: #3a1a1a;
      border: 1px solid #ff5252;
      color: #ffaaaa;
    }

    .settings {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .emoji-preview {
      font-size: 20px;
      margin-left: 10px;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
  <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
  <div class="tab-navigation">
    <button class="tab-btn active" onclick="switchTab('tab1')">
      ğŸ¬ WebP ì• ë‹ˆë©”ì´ì…˜ ìƒì„±ê¸°
    </button>
    <button class="tab-btn" onclick="switchTab('tab2')">
      ğŸ›¡ï¸ ê°€ê²©í‘œ ë³µì‚¬ë°©ì§€ ë³€í™˜ê¸°
    </button>
  </div>

  <!-- íƒ­1: WebP ìƒì„±ê¸° -->
  <div id="tab1" class="tab-content active">
    <div class="container">
      <h2>ğŸ¦‡ THE BLACK SHOP - WebP ì• ë‹ˆë©”ì´ì…˜ ìƒì„±ê¸°</h2>

      <div class="info-box">
        <strong>ğŸ’§ ì›Œí„°ë§ˆí¬ ìë™ ì ìš© ë²„ì „</strong><br>
        â€¢ ì´ 8ê°œ ë§ˆí¬: ëª¨ì„œë¦¬ 4ê°œ + ê°€ê²©í‘œ ë‚´ë¶€ 3ê°œ + í•˜ë‹¨ ìŠ¤í‹°ì»¤ 1ê°œ<br>
        â€¢ 4ê°€ì§€ ìƒ‰ìƒ ìë™ ìˆœí™˜: ê¸ˆìƒ‰ â†’ ì²­ë¡ â†’ ë³´ë¼ â†’ ë¹¨ê°•<br>
        â€¢ ë‚˜ ì˜í–ˆì£ ?? ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹
      </div>

      <div class="section">
        <h3>ğŸ“ ê°€ê²©í‘œ í…ìŠ¤íŠ¸ ì…ë ¥</h3>
        <textarea id="priceText" placeholder="ì—¬ê¸°ì— ê°€ê²©í‘œ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”...

ì˜ˆì‹œ:
âš”ï¸ ì‹œì¦Œ11 ë²„ìŠ¤ ì„œë¹„ìŠ¤
-------------------
ğŸ† ë­í¬ ë²„ìŠ¤
- ê³¨ë“œ â†’ í”Œë˜í‹°ë„˜: 50,000ì›
-------------------
ğŸ¯ ë˜ì „ ëŒ€ë¦¬
- ë‚˜ì´íŠ¸ë©”ì–´: 30,000ì›/ì‹œê°„
"></textarea>
        <button id="generateBtn" onclick="startGeneration()">ğŸ¨ WebP ì• ë‹ˆë©”ì´ì…˜ ìƒì„±</button>
      </div>

      <div class="progress-bar" id="progressBar">
        <div class="progress-fill" id="progressFill">0%</div>
      </div>

      <div id="message"></div>

      <div class="result-box" id="resultBox">
        <h4>âœ… ìƒì„± ì™„ë£Œ!</h4>

        <div class="preview-container">
          <h5 style="color: #ffd700;">ğŸ“‹ HTML ì½”ë“œ (ë³µì‚¬í•´ì„œ ì‚¬ìš©í•˜ì„¸ìš”)</h5>
          <textarea id="previewHtmlCode" readonly style="width:100%; height:150px; background:#1a1a1a; color:#0f0; border:2px solid #00ffd5; border-radius:8px; padding:15px; font-family:monospace; font-size:13px; margin-bottom:15px; resize:vertical;"></textarea>
          <button class="copy-btn" onclick="copyHtmlCode()">ğŸ“‹ HTML ì½”ë“œ ë³µì‚¬</button>

          <hr style="border:1px solid #333; margin:25px 0;">

          <h5 style="color: #ffd700;">ğŸ¬ WebP ì• ë‹ˆë©”ì´ì…˜ ë¯¸ë¦¬ë³´ê¸°</h5>
          <img id="webpPreview" src="" alt="WebP ë¯¸ë¦¬ë³´ê¸°" />
          <br>
          <p style="color: #aaa; font-size: 14px;">ğŸ’« https://open.kakao.com/o/gUVp9cwh ì—¬ê¸°ê°€ ì§„ì§œ ë”ë¸”ë™ìƒµ ì…ë‹ˆë‹¤</p>
          <button class="copy-btn" onclick="copyUrl()">ğŸ”— URL ë³µì‚¬</button>
          <button class="copy-btn" onclick="downloadImage()">ğŸ’¾ ë‹¤ìš´ë¡œë“œ</button>
        </div>
      </div>

      <div id="debugLog"></div>
    </div>

    <div id="hiddenRender"></div>
  </div>

  <!-- íƒ­2: ê°€ê²©í‘œ ë³€í™˜ê¸° -->
  <div id="tab2" class="tab-content">
    <div class="container">
      <h1>ë””ì•„4 ê°€ê²©í‘œ ë³µì‚¬ë°©ì§€ ë³€í™˜ê¸°</h1>

      <div class="section">
        <h2>ì›ë³¸ ì…ë ¥</h2>
        <textarea id="input" placeholder="ê°€ê²©í‘œ ë¶™ì—¬ë„£ê¸°" style="min-height: 400px;"></textarea>
      </div>

      <div class="section">
        <label>
          ë³µì¡ë„:
          <input type="number" id="fakeIntensity" value="5" min="1" max="10">
        </label>
      </div>

      <button onclick="convert()">ë³€í™˜í•˜ê¸°</button>

      <div class="section">
        <h2>HTML ì½”ë“œ</h2>
        <textarea id="output" readonly style="min-height: 400px;"></textarea>
        <button class="copy-btn" onclick="copyCode()" style="width: 100%;">ë³µì‚¬í•˜ê¸°</button>
      </div>

      <div class="section">
        <h2>ë¯¸ë¦¬ë³´ê¸°</h2>
        <div class="preview-box" id="preview">ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤</div>
      </div>
    </div>
  </div>

  <script>
    // ============================================
    // íƒ­ ì „í™˜ ê¸°ëŠ¥
    // ============================================
    function switchTab(tabId) {
      // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });

      // ì„ íƒí•œ íƒ­ í™œì„±í™”
      document.getElementById(tabId).classList.add('active');
      event.target.classList.add('active');
    }

    // ============================================
    // íƒ­1: WebP ìƒì„±ê¸° JavaScript
    // ============================================
    const API_URL = '/api/create-webp';

    const supabaseUrl = "https://ssnmitgehgzzcpmqwhzt.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNzbm1pdGdlaGd6emNwbXF3aHp0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMzNjI1MDgsImV4cCI6MjA2ODkzODUwOH0.u3FrSDh5qYeccQmn0PkOs4nfqIhXLSFHhpWj2JXhTrA";
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

    const chatUrl = "https://open.kakao.com/o/gUVp9cwh";
    let webpUrl = "";

    function log(message) {
      const debugLog = document.getElementById('debugLog');
      const timestamp = new Date().toLocaleTimeString();
      debugLog.innerHTML += `[${timestamp}] ${message}<br>`;
      debugLog.scrollTop = debugLog.scrollHeight;
      debugLog.classList.add('show');
      console.log(`[MAIN] ${message}`);
    }

    function showMessage(text, type = 'info') {
      const msg = document.getElementById('message');
      msg.textContent = text;
      msg.className = 'show ' + type;
    }

    function updateProgress(percent, text) {
      const fill = document.getElementById('progressFill');
      fill.style.width = percent + '%';
      fill.textContent = percent + '% - ' + text;
      document.getElementById('progressBar').classList.add('show');
    }

    function getWatermarkHTML() {
      return `
        <!-- 4ê°œ ëª¨ì„œë¦¬ ë°°ì§€ -->


        <!-- ê°€ê²©í‘œ ë‚´ë¶€ ëŒ€ê°ì„  ì›Œí„°ë§ˆí¬ 3ê°œ -->
        <div class="content-watermark wm-diagonal-1">https://open.kakao.com/o/gUVp9cwh âœ“</div>
        <div class="content-watermark wm-diagonal-2">https://open.kakao.com/o/gUVp9cwh âœ“</div>
        <div class="content-watermark wm-diagonal-3">https://open.kakao.com/o/gUVp9cwh âœ“</div>
        <div class="content-watermark wm-diagonal-4">https://open.kakao.com/o/gUVp9cwh âœ“</div>
<div class="content-watermark wm-diagonal-5">https://open.kakao.com/o/gUVp9cwh âœ“</div>
<div class="content-watermark wm-diagonal-6">https://open.kakao.com/o/gUVp9cwh âœ“</div>
<div class="content-watermark wm-diagonal-7">https://open.kakao.com/o/gUVp9cwh âœ“</div>
<div class="content-watermark wm-diagonal-8">https://open.kakao.com/o/gUVp9cwh âœ“</div>
      `;
    }

    function insertChatLinks(text, chatUrl) {
      const escapeHTML = (s) => s.replace(/[&<>"']/g, m => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
      }[m]));

      return escapeHTML(text);
    }

    function generateProtectedHtml(imageUrl) {
      return `<a href="https://open.kakao.com/o/gUVp9cwh" target="_blank" rel="noopener noreferrer" style="display:block; max-width:100%; margin:0 auto 20px auto; text-decoration:none;">
    <img src="${imageUrl}"
         alt="ì˜¤í”ˆì¹´í†¡ ì—°ê²°" style="cursor:pointer; max-width:100%; height:auto; border-radius:12px; display:block; margin:0 auto; -webkit-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none; -webkit-user-drag:none; -khtml-user-drag:none; -moz-user-drag:none; -o-user-drag:none; user-drag:none; pointer-events:none;" draggable="false">

</a>`;
    }

    function copyHtmlCode() {
      const codeTextarea = document.getElementById('previewHtmlCode');
      codeTextarea.select();
      navigator.clipboard.writeText(codeTextarea.value);
      alert('âœ… HTML ì½”ë“œê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nê²Œì‹œê¸€ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.');
    }

    function getDesignHTML(priceHtml) {
      return `
        <div class="header-static">
          <div class="auth-warning">
            âš ï¸ ë‹¨í†¡ë°© ì…ì¥ì‹œ ë§í¬ì£¼ì†Œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”. <BR> https://open.kakao.com/o/gUVp9cwh
          </div>
          <h1 class="shop-logo">
            <span class="icon">ğŸ¦‡</span> THE BLACK SHOP <span class="icon">ğŸ§›â€â™‚ï¸</span>
          </h1>
          <div class="shop-tagline">ë””ì•„ë¸”ë¡œ4 ì‹œì¦Œ11 ë²„ìŠ¤ Â· ëŒ€ë¦¬ Â· ì•„ì´í…œ ì „ë¬¸ ê±°ë˜ì†Œ</div>

          <ul class="shop-features">
            <li><span class="icon">ğŸ¦¾</span> ëª¨ë“  ì¥ë¹„, ì•„ì´í…œ, ì¬ë£Œ ì™„ë¹„</li>
            <li><span class="icon">ğŸšŒ</span> ë²„ìŠ¤, ëŒ€ë¦¬, ì„¸íŒ… í’€ ì§€ì›</li>
            <li><span class="icon">ğŸ¦¸â€â™‚ï¸</span> ê²½í—˜ ë§ì€ ì „ë¬¸ ê¸°ì‚¬ ìƒì‹œ ëŒ€ê¸°</li>
            <li><span class="icon">ğŸ”¥</span> í•©ë¦¬ì ì¸ ì‹¤ì‹œê°„ ìµœì €ê°€ ë³´ì¥</li>
          </ul>

          <div class="cta-btn">
            ğŸ’¬ ì˜¤í”ˆì±„íŒ…ì€ ê°€ê²©í‘œ í´ë¦­!
          </div>
        </div>

        <hr class="divider">

        <div class="price-content">
          <h2 class="price-title">ğŸ’° ì‹¤ì‹œê°„ ê°€ê²©í‘œ</h2>
          <div class="price-text">${priceHtml}</div>
        </div>
      `;
    }

    async function startGeneration() {
      const text = document.getElementById('priceText').value.trim();
      if (!text) {
        showMessage('ê°€ê²©í‘œ í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error');
        return;
      }

      log('=== WebP ì• ë‹ˆë©”ì´ì…˜ ìƒì„± ì‹œì‘ ===');
      document.getElementById('generateBtn').disabled = true;
      document.getElementById('resultBox').classList.remove('show');

      try {
        updateProgress(10, 'DB ì €ì¥ ì¤‘...');
        const { error } = await supabase
          .from("user_texts")
          .upsert({ user_id: "theblack04", main_text: text }, { onConflict: "user_id" });

        if (error) throw error;
        log('í…ìŠ¤íŠ¸ ì €ì¥ ì™„ë£Œ');

        updateProgress(20, '4ê°œ í”„ë ˆì„ ë Œë”ë§ ì¤‘...');
        showMessage('WebP ì• ë‹ˆë©”ì´ì…˜ ìƒì„± ì¤‘... 10~20ì´ˆ ì†Œìš”ë©ë‹ˆë‹¤!', 'info');

        const frames = await generateAllFrames(text);

        updateProgress(70, 'Vercel APIë¡œ WebP ìƒì„± ì¤‘...');
        log('Vercel API í˜¸ì¶œ');

        const webpDataUrl = await createWebPViaAPI(frames);

        updateProgress(90, 'Supabase ì—…ë¡œë“œ ì¤‘...');
        await uploadWebPToSupabase(webpDataUrl);

        updateProgress(100, 'ì™„ë£Œ!');
        showMessage('âœ… WebP ì• ë‹ˆë©”ì´ì…˜ ìƒì„± ì™„ë£Œ!', 'success');
        document.getElementById('resultBox').classList.add('show');
        log('=== ì‘ì—… ì™„ë£Œ ===');

      } catch (err) {
        log('ERROR: ' + err.message);
        showMessage('âŒ ì˜¤ë¥˜ ë°œìƒ: ' + err.message, 'error');
      } finally {
        document.getElementById('generateBtn').disabled = false;
      }
    }

    async function generateAllFrames(priceText) {
      const frames = [];
      const priceHtml = insertChatLinks(priceText, chatUrl);

      for (let i = 1; i <= 4; i++) {
        log(`í”„ë ˆì„ ${i} ë Œë”ë§ ì¤‘...`);
        updateProgress(20 + (i * 10), `í”„ë ˆì„ ${i}/4 ë Œë”ë§ ì¤‘...`);

        const frameHtml = `
          <div class="watermark-container price-image frame-${i}">
            ${getWatermarkHTML()}
            ${getDesignHTML(priceHtml)}
          </div>
        `;

        const container = document.getElementById('hiddenRender');
        container.innerHTML = frameHtml;

        await new Promise(resolve => setTimeout(resolve, 300));

        const target = container.querySelector('.watermark-container');
        const canvas = await html2canvas(target, {
          useCORS: true,
          allowTaint: true,
          backgroundColor: '#000000',
          scale: 1,
          logging: false,
          width: 720
        });

        frames.push(canvas.toDataURL('image/jpeg', 0.9));
        log(`í”„ë ˆì„ ${i} ìº¡ì²˜ ì™„ë£Œ`);
      }

      return frames;
    }

    async function createWebPViaAPI(frames) {
      log('Vercel API ìš”ì²­ ì‹œì‘');

      const response = await fetch(API_URL, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ frames: frames })
      });

      if (!response.ok) {
        throw new Error(`API ì˜¤ë¥˜: ${response.status} ${response.statusText}`);
      }

      const result = await response.json();

      if (!result.success) {
        throw new Error(result.error || 'WebP ìƒì„± ì‹¤íŒ¨');
      }

      log(`WebP ìƒì„± ì™„ë£Œ (í¬ê¸°: ${(result.size / 1024).toFixed(2)} KB)`);
      return result.webp;
    }

    async function uploadWebPToSupabase(dataUrl) {
      log('Supabase ì—…ë¡œë“œ ì‹œì‘');

      const blob = await (await fetch(dataUrl)).blob();
      await supabase.storage.from("changong-images").remove(['theblack_animated.webp']);

      const { error } = await supabase.storage
        .from("changong-images")
        .upload('theblack_animated.webp', blob, {
          contentType: 'image/webp',
          cacheControl: "3600",
          upsert: true,
        });

      if (error) throw error;

      webpUrl = supabase.storage
        .from("changong-images")
        .getPublicUrl('theblack_animated.webp').data.publicUrl;

      log(`ì—…ë¡œë“œ ì™„ë£Œ: ${webpUrl}`);

      document.getElementById('webpPreview').src = webpUrl + '?t=' + Date.now();

      const resultCodeValue = generateProtectedHtml(webpUrl);
      document.getElementById("previewHtmlCode").value = resultCodeValue;
      log("HTML ì½”ë“œ ìƒì„± ì™„ë£Œ");
    }

    function copyUrl() {
      navigator.clipboard.writeText(webpUrl);
      alert('URLì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n' + webpUrl);
    }

    function downloadImage() {
      const a = document.createElement('a');
      a.href = webpUrl;
      a.download = 'theblack_animated.webp';
      a.click();
    }

    // ============================================
    // íƒ­2: ê°€ê²©í‘œ ë³€í™˜ê¸° JavaScript
    // ============================================
    function generateRandomClass() {
      const chars = 'abcdefghijklmnopqrstuvwxyz';
      let result = '';
      for (let i = 0; i < 8; i++) {
        result += chars[Math.floor(Math.random() * chars.length)];
      }
      return result;
    }

    function generateFakePrices(realPrice, count) {
      const prices = [];
      const base = parseInt(realPrice.replace(/,/g, ''));

      for (let i = 0; i < count; i++) {
        const variance = (Math.random() - 0.5) * base * 0.8;
        let fake = Math.round((base + variance) / 1000) * 1000;
        if (fake < 1000) fake = 1000;
        prices.push(fake.toLocaleString());
      }

      return prices;
    }

    function generateFakeQuantities(realQty, count) {
      const quantities = [];
      const base = parseInt(realQty.replace(/,/g, ''));

      for (let i = 0; i < count; i++) {
        const variance = (Math.random() - 0.5) * base * 1.2;
        let fake = Math.round((base + variance) / 100) * 100;
        if (fake < 100) fake = 100;
        quantities.push(fake.toLocaleString());
      }

      return quantities;
    }

    function generateFakeItemNames(realName) {
      const variations = [];

      const similar = {
        'ë¯¸ì§€ìˆ˜ì •': ['ë¯¸ì§€ì˜ìˆ˜ì •', 'ë¯¸ì§€ ìˆ˜ì •', 'ìˆ˜ì •', 'ë¯¸ì§€', 'ë¯¸ì§€ê²°ì •', 'ë¯¸ì§€ì„', 'ì‹ ë¹„ìˆ˜ì •', 'ìˆ˜ì •ì„'],
        'ìŠíŒì˜í˜¼': ['ìŠí˜€ì§„ì˜í˜¼', 'ìŠì˜í˜¼', 'ì˜í˜¼', 'ìŠíŒë ¹', 'ìŠí˜¼', 'ë§ê°ì˜í˜¼', 'ì˜í˜¼ì„', 'ìŠíŒ ì˜í˜¼'],
        'ê³¨ë“œ': ['Gold', 'ê³¨', 'ê¸ˆí™”', 'G', 'ê¸ˆ', 'ì¬í™”', 'gold'],
        'ê»ë°ê¸°': ['ê»ì§ˆ', 'ì™¸í”¼', 'ê»', 'ë°ê¸°', 'ê°‘í”¼', 'ì™¸ê°', 'ê» ë°ê¸°'],
        'ì˜µë‘': ['ì˜µì…˜ë‘ë£¨ë§ˆë¦¬', 'ì˜µì…˜ ë‘ë£¨ë§ˆë¦¬', 'ì˜µ', 'ë‘ë£¨ë§ˆë¦¬', 'ì˜µì…˜', 'ë‘ë£¨', 'ì˜µì…˜ìŠ¤í¬ë¡¤'],
        'ì •ë³µì': ['ì •ë³µ', 'ì •ë³µê°€', 'ì»¨ì»¤ëŸ¬', 'ì • ë³µì', 'Conqueror', 'ì •ë³µìë ™', 'ì •ë³µë ™'],
        'ë¬¸ì–‘': ['ë¬¸', 'ì–‘', 'ê¸€ë¦¬í”„', 'Glyph', 'ë¬¸ ì–‘', 'ê°ì¸'],
        'ì‹œì¦Œ': ['Season', 'ì‹œ ì¦Œ', 'S', 'ì‹œì¦Œ2', 'ì‹œì¦Œ3'],
        'ì˜ì›': ['Eternal', 'ì˜ ì›', 'ì˜êµ¬', 'ì´í„°ë„'],
        'ê³ í†µíŒŒí¸': ['ê³ í†µ íŒŒí¸', 'ê³ í†µ', 'íŒŒí¸', 'ê³ í†µì˜íŒŒí¸', 'íŒŒí¸(ê³ í†µ)', 'ê³ í†µì¡°ê°'],
        'ë°”ëŠ˜ì¸í˜•': ['ë°”ëŠ˜ ì¸í˜•', 'ë°”ëŠ˜', 'ì¸í˜•', 'ì¹¨ì¸í˜•', 'ë°”ëŠ˜í˜•', 'ì¸í˜•(ë°”ëŠ˜)'],
        'ì•…ì˜ì‹¬ì¥': ['ì•…ì˜ ì‹¬ì¥', 'ì•…ì˜', 'ì‹¬ì¥', 'ì•…ë§ˆì‹¬ì¥', 'ì‹¬ì¥(ì•…ì˜)', 'ì•…ì˜ì‹¬'],
        'ì •ì œê³µí¬': ['ì •ì œ ê³µí¬', 'ì •ì œ', 'ê³µí¬', 'ê³µí¬ì •ì œ', 'ê³µí¬ì„', 'ì •ì œëœê³µí¬'],
        'ê·¹ìƒì˜í”¼': ['ê·¹ìƒì˜ í”¼', 'ê·¹ìƒ', 'í”¼', 'ìµœìƒì˜í”¼', 'í”¼(ê·¹ìƒ)', 'ê·¹ìƒí”¼'],
        'ê°•ì² ': ['Steel', 'ê°•', 'ì² ', 'ê°• ì² ', 'ìŠ¤í‹¸'],
        'ë£¬': ['Rune', 'ë£¬ì„', 'ê°ì¸ì„', 'ë¶€ì '],
        'ìƒ¤ì½”': ['Shaco', 'ìƒ¤ ì½”', 'ìƒ¤', 'ì½”', 'ìƒ¤ì½”í…œ'],
        'ì˜ë²Œ': ['ì˜ì›í•œë²Œ', 'ì˜ì›ë²Œ', 'ì˜ ë²Œ', 'ë²Œ'],
        'ë³„ë°˜': ['ë³„ì˜ë°˜ì§€', 'ë³„ ë°˜ì§€', 'ë³„ë°˜ì§€', 'ë°˜ì§€'],
        'ìˆ˜ì˜': ['ìˆ˜ ì˜', 'ìˆ˜'],
        'í•œì•„ë¹„': ['í•œ ì•„ë¹„', 'í•œ', 'ì•„ë¹„'],
        'ê¶¤ë©¸ì': ['ê¶¤ë©¸', 'ê¶¤ ë©¸ì', 'ê¶¤ë©¸í…œ'],
        'ì›…ì¥í•œë³´ì„': ['ì›…ì¥í•œ ë³´ì„', 'ì›…ì¥ë³´ì„', 'ë³´ì„', 'ì›…ì¥ì„', 'ë³´ì„(ì›…ì¥)', 'Grand Gem'],
        'ë°˜ì§ì´ëŠ”ë²¼ë½ë¶ˆ': ['ë°˜ì§ì´ëŠ” ë²¼ë½ë¶ˆ', 'ë²¼ë½ë¶ˆ', 'ë°˜ì§ë²¼ë½', 'ë²ˆê°œë¶ˆ', 'ë²¼ë½'],
        'ìš°ë²„': ['Uber', 'ìš° ë²„', 'ìœ ë²„', 'ìµœì¢…ë³´ìŠ¤'],
        'í˜¼ëˆí…œ': ['í˜¼ëˆ í…œ', 'í˜¼ëˆ', 'ì¹´ì˜¤ìŠ¤í…œ', 'í˜¼ëˆì¥ë¹„', 'í˜¼ëˆì•„ì´í…œ'],
        'ë²¨ë¦¬ì•Œ': ['Belial', 'ë²¨ë¦¬', 'ë²¨ ë¦¬ì•Œ'],
        'ë¦´ë¦¬íŠ¸': ['Lilith', 'ë¦´ ë¦¬íŠ¸', 'ë¦´ë¦¬'],
        'ë‚˜ë½': ['Pit', 'ë‚˜ ë½', 'êµ¬ë©ì´', 'ì§€í•˜'],
        'ê³ í–‰': ['Torment', 'ê³  í–‰', 'í† ë¨¼íŠ¸', 'ê³ ë‚œ'],
        'ëª…ë§': ['Renown', 'ëª… ë§', 'ëª…ì„±', 'í‰íŒ'],
        'ìº í˜ì¸': ['Campaign', 'ìº í˜', 'ìŠ¤í† ë¦¬', 'ìº  í˜ì¸'],
        'ì¦ì˜¤ì˜ê·¸ë¦‡': ['ì¦ì˜¤ì˜ ê·¸ë¦‡', 'ì¦ì˜¤ê·¸ë¦‡', 'ê·¸ë¦‡', 'ì¦ì˜¤'],
        'ì§€ì˜¥ë¶ˆêµ°ì„¸': ['ì§€ì˜¥ë¶ˆ êµ°ì„¸', 'ì§€ì˜¥êµ°ì„¸', 'êµ°ì„¸', 'ì§€ì˜¥ë¶ˆ', 'í—¬íƒ€ì´ë“œ'],
        'ì•¼ë§Œ': ['ì•¼ë§Œìš©ì‚¬', 'ë°”ë°”', 'Barb', 'ì•¼ë§Œì¸', 'ì•¼ ë§Œ'],
        'ê°•ë ¹': ['ê°•ë ¹ìˆ ì‚¬', 'ë„¤í¬ë¡œ', 'Necro', 'ê°•ë ¹ì‚¬', 'ê°• ë ¹'],
        'ë“œë£¨': ['ë“œë£¨ì´ë“œ', 'Druid', 'ë“œë£¨ë“œ', 'ë“œ ë£¨'],
        'ì›ì†Œ': ['ì›ì†Œìˆ ì‚¬', 'ì†Œì„œ', 'Sorc', 'ì›ì†Œì‚¬', 'ì› ì†Œ'],
        'ë„ì ': ['Rogue', 'ë¡œê·¸', 'ë„ ì ', 'ë¡œê·¸'],
        'í˜¼ë ¹': ['í˜¼ë ¹ì‚¬', 'Spirit', 'ìŠ¤í”¼ë¦¿', 'í˜¼ ë ¹'],
      };

      for (let key in similar) {
        if (realName.includes(key)) {
          variations.push(...similar[key]);
        }
      }

      if (!realName.includes(' ')) {
        for (let i = 1; i < realName.length; i++) {
          variations.push(realName.substring(0, i) + ' ' + realName.substring(i));
        }
      } else {
        variations.push(realName.replace(/\s/g, ''));
      }

      if (realName.length > 3) {
        variations.push(realName.substring(0, realName.length - 1));
        variations.push(realName.substring(1));
        variations.push(realName.substring(0, Math.floor(realName.length / 2)));
        variations.push(realName.substring(Math.ceil(realName.length / 2)));
      }

      variations.push(realName + '!');
      variations.push(realName + 'â˜…');
      variations.push('â—†' + realName);

      if (/[a-zA-Z]/.test(realName)) {
        variations.push(realName.toLowerCase());
        variations.push(realName.toUpperCase());
      }

      variations.push(realName + '1');
      variations.push(realName + 'x');

      const unique = [...new Set(variations)].filter(v => v && v.trim() && v !== realName);

      return unique.slice(0, 8);
    }

    function getRandomHideStyle() {
      return 'COMMENT';
    }

    function convert() {
      const input = document.getElementById('input').value;
      const kakaoLink = 'https://open.kakao.com/o/gUVp9cwh';
      const fakeIntensity = parseInt(document.getElementById('fakeIntensity').value) || 5;

      if (!input.trim()) {
        alert('ê°€ê²©í‘œë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
        return;
      }

      const lines = input.split('\n');

      let html = '<div style="text-align:center;line-height:1.5;margin:0;padding:0;">';

      for (let i = 0; i < fakeIntensity * 3; i++) {
        html += `<a href="${kakaoLink}" style="display:none;">.</a>`;
      }

      html += `<div style="border:none;padding:0;margin:0;">`;
      html += `<div style="font-size:28px;font-weight:bold;color:#d4a017;margin-bottom:5px;">ğŸ¦‡ THE BLACK SHOP ğŸ§›â€â™‚ï¸</div>`;
      html += `<div style="font-size:18px;color:#333;margin-bottom:10px;">ë””ì•„ë¸”ë¡œ4 ì‹œì¦Œ11 ë²„ìŠ¤ Â· ëŒ€ë¦¬ Â· ì•„ì´í…œ ì „ë¬¸ ê±°ë˜ì†Œ</div>`;
      html += `<div style="font-size:16px;color:#444;line-height:1.8;">ğŸ¦¾ ëª¨ë“  ì¥ë¹„, ì•„ì´í…œ, ì¬ë£Œ ì™„ë¹„</div>`;
      html += `<div style="font-size:16px;color:#444;line-height:1.8;">ğŸšŒ ë²„ìŠ¤, ëŒ€ë¦¬, ì„¸íŒ… í’€ ì§€ì›</div>`;
      html += `<div style="font-size:16px;color:#444;line-height:1.8;">ğŸ¦¸â€â™‚ï¸ ê²½í—˜ ë§ì€ ì „ë¬¸ ê¸°ì‚¬ ìƒì‹œ ëŒ€ê¸°</div>`;
      html += `<div style="font-size:16px;color:#444;line-height:1.8;">ğŸ”¥ í•©ë¦¬ì ì¸ ì‹¤ì‹œê°„ ìµœì €ê°€ ë³´ì¥</div>`;
      html += `<div style="font-size:18px;font-weight:bold;color:#0099cc;margin:10px 0 5px 0;">ğŸ’¬ ì˜¤í”ˆì±„íŒ…ì€ ê°€ê²©í‘œ í´ë¦­!</div>`;

      for (let i = fakeIntensity * 3; i < fakeIntensity * 5; i++) {
        html += `<a href="${kakaoLink}" style="display:none;">.</a>`;
      }

      html += `<a href="${kakaoLink}" target="_blank" style="color:#666;margin:5px 0;font-size:14px;">â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”</a>`;
      html += `</div>`;

      for (let i = fakeIntensity * 5; i < fakeIntensity * 6; i++) {
        html += `<a href="${kakaoLink}" style="display:none;">.</a>`;
      }

      html += `<div style="font-size:24px;font-weight:bold;color:#00aa66;margin:10px 0 5px 0;">ğŸ’° ì‹¤ì‹œê°„ ê°€ê²©í‘œ</div>`;

      for (let i = 0; i < lines.length; i++) {
        const line = lines[i];

        if (line.trim().startsWith('ï¼Š') || line.trim().startsWith('*')) {
          html += `<div style="margin-top:15px;"></div>`;
          for (let k = 0; k < 3; k++) {
            html += `<a href="${kakaoLink}" style="display:none;">.</a>`;
          }
          html += `<a href="${kakaoLink}" target="_blank" style="color:#999;margin:8px 0;">open.kakao.com/o/gUVp9cwh</a>`;
          for (let k = 3; k < 6; k++) {
            html += `<a href="${kakaoLink}" style="display:none;">.</a>`;
          }
          html += `<div style="margin-bottom:15px;"></div>`;
          continue;
        }

        let fakeSpans = '';

        const priceMatch = line.match(/(\d{1,3}(,\d{3})*)\s*ì›/g);
        const qtyMatch = line.match(/(\d{1,3}(,\d{3})*)\s*(ê°œ|ì–µ|ë§Œê°œ|set)/g);

        if (priceMatch) {
          priceMatch.forEach(price => {
            const fakes = generateFakePrices(price.replace('ì›', ''), fakeIntensity);
            fakes.forEach(fake => {
              const fakeLine = line.replace(price, fake + 'ì›');
              fakeSpans += `<span style="position:absolute;color:transparent;font-size:0.1px;">${fakeLine}</span>`;
            });
          });
        }

        if (qtyMatch) {
          qtyMatch.forEach(qty => {
            const unit = qty.match(/(ê°œ|ì–µ|ë§Œê°œ|set)/)[0];
            const fakes = generateFakeQuantities(qty.replace(unit, ''), Math.ceil(fakeIntensity / 2));
            fakes.forEach(fake => {
              const fakeLine = line.replace(qty, fake + unit);
              fakeSpans += `<span style="position:absolute;color:transparent;font-size:0.1px;">${fakeLine}</span>`;
            });
          });
        }

        const noEmoji = line.replace(/[\u{1F300}-\u{1F9FF}]/gu, '').replace(/--/g, '').trim();

        if (line.includes('=')) {
          const parts = line.split('=');
          const leftPart = parts[0].replace(/[\u{1F300}-\u{1F9FF}]/gu, '').replace(/--/g, '').trim();
          const itemNames = leftPart.split(/\s+/).filter(word => word.length > 1);

          itemNames.forEach(itemName => {
            const fakeNames = generateFakeItemNames(itemName);
            fakeNames.forEach(fakeName => {
              if (fakeName && fakeName !== itemName) {
                const fakeLine = line.replace(itemName, fakeName);
                fakeSpans += `<span style="position:absolute;color:transparent;font-size:0.1px;">${fakeLine}</span>`;
              }
            });
          });
        } else {
          if (noEmoji.length > 2) {
            const words = noEmoji.split(/\s+/).filter(word => word.length > 1);
            words.forEach(word => {
              const fakeNames = generateFakeItemNames(word);
              fakeNames.forEach(fakeName => {
                if (fakeName && fakeName !== word) {
                  const fakeLine = line.replace(word, fakeName);
                  fakeSpans += `<span style="position:absolute;color:transparent;font-size:0.1px;">${fakeLine}</span>`;
                }
              });
            });
          }
        }

        if (line.includes('=')) {
          const parts = line.split('=');
          if (parts.length === 2) {
            const reversed = `${parts[1].trim()} = ${parts[0].trim()}`;
            fakeSpans += `<span style="position:absolute;color:transparent;font-size:0.1px;">${reversed}</span>`;
          }
        }

        for (let j = 0; j < Math.ceil(fakeIntensity / 3); j++) {
          const noise = line.split('').sort(() => Math.random() - 0.5).join('');
          fakeSpans += `<span style="position:absolute;color:transparent;font-size:0.1px;">${noise}</span>`;
        }

        html += `<div style="position:relative;display:block;margin-bottom:3px;">${line}${fakeSpans}</div>`;
      }

      html += '</div>';

      document.getElementById('preview').innerHTML = html;
      document.getElementById('output').value = html;
    }

    function copyCode() {
      const output = document.getElementById('output');
      output.select();
      document.execCommand('copy');
      alert('ë³µì‚¬ ì™„ë£Œ!');
    }

    window.onload = function() {
      document.getElementById('input').value = '';
    };
  </script>
</body>
</html>
